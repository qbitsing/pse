"use strict";angular.module("frontendPseApp",["ui.router","ui.bootstrap","ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngSanitize","ngTouch","LocalStorageModule","perfect_scrollbar","ui.grid","ui.grid.autoResize","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.pagination","ui.grid.cellNav","duScroll"]).config(["localStorageServiceProvider",function(e){e.setPrefix("pseApp").setStorageType("localStorage").setNotify(!0,!0)}]).config(["$stateProvider","$urlRouterProvider",function(e,a){a.when("/Dashboard","/Login"),a.otherwise("/Login"),e.state("base",{abstract:!0,url:"/Dashboard",templateUrl:"views/pages/base.html",controller:"BaseCtrl"}).state("Login",{url:"/Login",templateUrl:"views/pages/login.html",controller:"LoginCtrl"}).state("Home",{url:"/Home",parent:"base",templateUrl:"views/pages/home.html",controller:"HomeCtrl"}).state("Usuarios",{url:"/Usuarios",parent:"base",templateUrl:"views/pages/usuarios.html",controller:"UsuariosCtrl"}).state("Empresas",{url:"/Empresas",parent:"base",templateUrl:"views/pages/empresas.html",controller:"EmpresasCtrl"}).state("Items",{url:"/Gestion_Control_Equipos",parent:"base",templateUrl:"views/pages/items.html",controller:"ItemsCtrl"}).state("Sitios",{url:"/Gestion_Control_Escenarios",parent:"base",templateUrl:"views/pages/sitios.html",controller:"SitiosCtrl"}).state("Actividades",{url:"/Gestion_Control_Actividades",parent:"base",templateUrl:"views/pages/actividades.html",controller:"ActividadesCtrl"}).state("Prestamos",{url:"/Prestamos",parent:"base",templateUrl:"views/pages/prestamos.html",controller:"PrestamosCtrl"})}]),angular.module("frontendPseApp").value("duScrollDuration",700).value("duScrollOffset",60).value("duScrollActiveClass","active-login").value("duScrollBottomSpy",!0).controller("LoginCtrl",["$scope","$state","ApiPse","SesionUsuario","$uibModal","$document",function(e,a,t,i,o,n){AOS.init(),null!=i.ObtenerSesion()&&a.go("Home"),e.userLogin=function(){e.cargando=!0,t.getResource("Usuarios/Login",e.login).then(function(t){e.cargando=!1,1==t.data.Estado?(i.CrearSesion(t.data.user),a.go("Home")):(e.login.contrasenaa="",alert(t.data.Datos))},function(e){})},e.topLogin=function(){n.scrollToElementAnimated(angular.element(document.getElementById("Login")))}}]),angular.module("frontendPseApp").directive("navegacionLogin",function(){return{templateUrl:"views/directives/nav.html",restrict:"E",link:function(e,a,t){}}}),angular.module("frontendPseApp").controller("HomeCtrl",function(){}),angular.module("frontendPseApp").controller("BaseCtrl",["$state","$scope","SesionUsuario",function(e,a,t){a.$state=e,null==t.ObtenerSesion()&&e.go("Login")}]),angular.module("frontendPseApp").factory("ApiPse",["$http","SesionUsuario",function(e,a){return{getResource:function(t,i){var o="http://Api-pse/"+t;null!=a.ObtenerSesion()&&(void 0!=i?i.userAction=a.ObtenerSesion().id:i={userAction:a.ObtenerSesion().id});var n={method:"POST",url:o,headers:{"Content-Type":void 0},data:i};return e(n)}}}]),angular.module("frontendPseApp").factory("SesionUsuario",["localStorageService",function(e){return{CrearSesion:function(a){e.set("SesionUsuario",a)},ObtenerSesion:function(){return e.get("SesionUsuario")},CerrarSesion:function(){return e.remove("SesionUsuario")}}}]),angular.module("frontendPseApp").directive("sidenav",function(){return{templateUrl:"views/directives/sidenav.html",restrict:"E",link:function(e,a,t){},controller:["$scope","SesionUsuario","$state",function(e,a,t){e.Usuario=a.ObtenerSesion(),"gn-open-all"!=e.ClickMenu&&angular.element(".main-view").css("margin-left","48px"),e.CerrarSesion=function(){a.CerrarSesion(),t.go("Login")},e.menu=function(){"undefined"!=typeof window.orientation&&(e.ClickMenu="",angular.element(".main-view").css("margin-left","48px"))},e.sidenav=function(){"gn-open-all"==e.ClickMenu?(e.ClickMenu="",angular.element(".main-view").css("margin-left","48px")):(e.ClickMenu="gn-open-all",angular.element(".main-view").css("margin-left","250px"))}}]}}),angular.module("frontendPseApp").controller("UsuariosCtrl",["$scope","ApiPse","SesionUsuario","$timeout","Tabla","Estados","CasillaBotones","$uibModal",function(e,a,t,i,o,n,r,s){function d(){a.getResource("Empresas/ListarDisponible").then(function(a){1==a.data.Estado&&(e.empresas=a.data.Datos)},function(e){})}function l(){var t="";"Administrador"==e.Usuario.rol?t="Usuarios/ListarEmpresa/"+e.Usuario.id_empresa:"Super Administrador"==e.Usuario.rol&&(t="Usuarios/Listar"),a.getResource(t).then(function(a){1==a.data.Estado&&(e.Usuarios=a.data.Datos,e.gridOptions.data=e.Usuarios)},function(e){})}e.PanelTitulo="Registro de usuarios",e.BotonTitulo="Registrar Usuario",e.cargando=!1,e.Estados=n,e.Register={},e.Usuario=t.ObtenerSesion(),e.panelAnimate="",e.pageAnimate="";var c=null;i(function(){e.pageAnimate="pageAnimate",e.panelAnimate="panelAnimate"},100);var u="<div>";u+=r.Toggle,u+=r.Editar,u+=r.Detalles,u+=r.Borrar,u+="</div>",e.gridOptions={columnDefs:[{field:"nombres",width:"15%",minWidth:170},{field:"apellidos",width:"15%",minWidth:170},{name:"Documento",field:"id",width:"15%",minWidth:170},{field:"rol",width:"15%",minWidth:170},{field:"estado",cellTemplate:"<div>{{grid.appScope.Estados.Estados[row.entity.estado]}}</div>",width:"15%",minWidth:170},{name:"Opciones",enableFiltering:!1,cellTemplate:u,width:"25%",minWidth:250}]},angular.extend(e.gridOptions,o),e.Registrar=function(){var t="Usuarios/Crear";"Guardar Cambios"==e.BotonTitulo&&(t="Usuarios/Actualizar/"+e.Register.id),e.cargando=!0,"Administrador"==e.Usuario.rol&&(e.Register.id_empresa=e.Usuario.id_empresa),a.getResource(t,e.Register).then(function(a){1==a.data.Estado&&(e.PanelTitulo="Registro de usuarios",e.BotonTitulo="Registrar Usuario","Usuarios/Crear"==t?(e.Usuario.push(e.Register),e.Register={}):(e.Usuarios[e.Register.index]=e.Register,e.Register={})),e.cargando=!1},function(a){e.Register={},e.cargando=!1})},e.Editar=function(a){var t=e.Identifiar(a);e.Register=t,e.PanelTitulo="Editar usuario",e.BotonTitulo="Guardar Cambios"},e.Borrar=function(t){e.cargando=!0;var i=e.Identifiar(t),o="Usuarios/Eliminar/"+i.id;a.getResource(o).then(function(a){1==a.data.Estado&&e.Usuarios.splice(i.index,1),e.cargando=!1},function(a){e.cargando=!1,console.log(a)})},e.Toggle=function(t){e.cargando=!0;var i=e.Identifiar(t);1==i.estado?i.estado=0:i.estado=1;var o="Usuarios/Actualizar/"+i.id;a.getResource(o,i).then(function(a){1==a.data.Estado&&(e.Usuarios[i.index]=i),e.cargando=!1},function(a){e.cargando=!1,console.log(a)}),console.log(i)},e.Detalles=function(a){e.obj=e.Identifiar(a),c=s.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"myModalContent.html",controller:"DetalleUsuarioModalCtrl",resolve:{Scope:function(){return e}}})},e.cerrarModal=function(){c.close()},e.CancelarEditar=function(){e.PanelTitulo="Registro de usuarios",e.BotonTitulo="Registrar Usuario",e.Register={}},e.Identifiar=function(a){var t={};return e.Usuarios.forEach(function(e,i){e.id==a&&(t.index=i,t.id=e.id,t.rol=e.rol,t.nombres=e.nombres,t.apellidos=e.apellidos,t.telefono=e.telefono,t.direccion=e.direccion,t.correo=e.correo,t.estado=e.estado,t.id_empresa=e.id_empresa,t.tipo_doc=e.tipo_doc.toString())}),t},d(),l()}]).controller("DetalleUsuarioModalCtrl",["$scope","Scope",function(e,a){e.Detalle=a.obj,console.log(e.Detalle),e.Cerrar=function(){a.cerrarModal()}}]),angular.module("frontendPseApp").directive("tbas",function(){return{template:"<div></div>",restrict:"E",link:function(e,a,t){a.text("this is the tbas directive")}}}),angular.module("frontendPseApp").controller("EmpresasCtrl",["$scope","SesionUsuario","ApiPse","$state","$timeout","Tabla","Estados","CasillaBotones","$uibModal",function(e,a,t,i,o,n,r,s,d){function l(){t.getResource("Empresas/ListarDepartamentos").then(function(a){1==a.data.Estado&&(e.departamentos=a.data.Datos)},function(e){console.log(e)})}function c(){t.getResource("Empresas/ListarCiudades").then(function(a){1==a.data.Estado&&(e.ciudades=a.data.Datos)},function(e){})}function u(){t.getResource("Empresas/ListarDisponible").then(function(a){1==a.data.Estado&&(e.empresas=a.data.Datos,console.log(a),e.gridOptions.data=e.empresas)},function(e){console.log(e)})}e.Usuario=a.ObtenerSesion(),"Super Administrador"!=e.Usuario.rol&&i.go("Home"),e.PanelTitulo="Registro de empresas",e.BotonTitulo="Registrar empresa",e.cargando=!1,e.Estados=r,e.panelAnimate="",e.pageAnimate="";var g=null;o(function(){e.pageAnimate="pageAnimate",e.panelAnimate="panelAnimate"},100);var p="<div>";p+=s.Toggle,p+=s.Editar,p+=s.Detalles,p+=s.Borrar,p+="</div>",e.gridOptions={columnDefs:[{name:"NIT",field:"id"},{field:"nombre"},{field:"direccion"},{field:"telefono"},{field:"estado",cellTemplate:"<div>{{grid.appScope.Estados.Estados[row.entity.estado]}}</div>"},{name:"Opciones",enableFiltering:!1,cellTemplate:p}]},angular.extend(e.gridOptions,n),e.Registrar=function(){e.cargando=!0,t.getResource("Empresas/Crear",e.Register).then(function(a){e.empresas.push(e.Register),e.Register={},e.cargando=!1},function(a){e.cargando=!1})},e.Editar=function(a){var t=e.Identifiar(a);e.Register=t,e.PanelTitulo="Editar empresa",e.BotonTitulo="Guardar Cambios"},e.Borrar=function(a){e.cargando=!0;var i=e.Identifiar(a),o="Empresas/Eliminar/"+i.id;t.getResource(o).then(function(a){1==a.data.Estado&&e.empresas.splice(i.index,1),e.cargando=!1},function(a){e.cargando=!1,console.log(a)})},e.Toggle=function(a){e.cargando=!0;var i=e.Identifiar(a);1==i.estado?i.estado=0:i.estado=1;var o="Empresas/Actualizar/"+i.id;t.getResource(o,i).then(function(a){1==a.data.Estado&&(e.empresas[i.index]=i),e.cargando=!1},function(a){e.cargando=!1,console.log(a)}),console.log(i)},e.Detalles=function(a){e.obj=e.Identifiar(a),g=d.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"myModalContent.html",controller:"DetalleEmpresaModalCtrl",resolve:{Scope:function(){return e}}})},e.cerrarModal=function(){g.close()},e.CancelarEditar=function(){e.PanelTitulo="Registro de empresas",e.BotonTitulo="Registrar empresa",e.Register={}},e.Identifiar=function(a){var t={};return e.empresas.forEach(function(e,i){e.id==a&&(t.index=i,t.id=e.id,t.nombre=e.nombre,t.telefono=e.telefono,t.direccion=e.direccion,t.id_departamento=e.id_departamento,t.ciudad=e.ciudad,t.estado=e.estado)}),t},l(),c(),u()}]).controller("DetalleEmpresaModalCtrl",["$scope","Scope",function(e,a){e.Detalle=a.obj,console.log(e.Detalle),e.Cerrar=function(){a.cerrarModal()}}]),angular.module("frontendPseApp").controller("ItemsCtrl",["$scope","$uibModal","ApiPse","SesionUsuario","$state","$timeout","Tabla","Estados","CasillaBotones",function(e,a,t,i,o,n,r,s,d){function l(){t.getResource("Items/ListarDisponible/"+e.Usuario.id_empresa).then(function(a){1==a.data.Estado?(e.items=a.data.Datos,e.gridOptions.data=e.items):(e.items=[],e.gridOptions.data=e.items,alert(a.data.Datos))},function(e){})}function c(){t.getResource("Herramientas/ListarDisponible/"+e.Usuario.id_empresa).then(function(a){1==a.data.Estado?(e.herramientas=a.data.Datos,e.herras=a.data.Datos,e.gridDates.data=e.herras):(e.herramientas=[],e.herras=[],e.gridDates.data=e.herras,alert(a.data.Datos))},function(e){})}e.Estados=s,e.cargando=!1,e.cargandodos=!1;var u=null;e.Usuario=i.ObtenerSesion(),e.panelAnimate="",e.pageAnimate="",n(function(){e.pageAnimate="pageAnimate",e.panelAnimate="panelAnimate"},100);var g="<div>";g+=d.Borrar,g+="</div>";var p="<div>";p+=d.Borrar,p+="</div>",e.gridOptions={columnDefs:[{field:"id"},{field:"herramienta"},{field:"modelo"},{field:"codigo_unico"},{name:"Opciones",enableFiltering:!1,cellTemplate:g}]},e.gridDates={columnDefs:[{field:"id"},{field:"nombre"},{name:"Opciones",enableFiltering:!1,cellTemplate:p}]},angular.extend(e.gridOptions,r),angular.extend(e.gridDates,r),"Super Administrador"==i.ObtenerSesion().rol&&o.go("Home"),e.Registrar=function(){e.cargando=!0,e.Register.id_empresa=e.Usuario.id_empresa,t.getResource("Items/Crear",e.Register).then(function(a){if(e.cargando=!1,1==a.data.Estado){for(var t=0;t<e.herramientas.length;t++)e.herramientas[t].id==parseInt(e.Register.id_herramienta)&&(e.Register.herramienta=e.herramientas[t].nombre);e.Register.id=a.data.Datos.id,e.items.push(e.Register),e.Register={}}else alert(a.data.Datos)},function(e){})},e.AbrirModal=function(){u=a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"myModalContent.html",controller:"CrearHerramientaCtrl",resolve:{Scope:function(){return e}}})},e.cerrarModal=function(){e.Herramienta={},u.close()},c(),l()}]).controller("CrearHerramientaCtrl",["$scope","Scope","$uibModal","ApiPse","Estados",function(e,a,t,i,o){e.Estados=o,e.cargandodos=!1,e.gridDates=a.gridDates,e.RegisterHerramienta=function(){e.cargandodos=!0,e.Herramienta.id_empresa=a.Usuario.id_empresa,i.getResource("Herramientas/Crear",e.Herramienta).then(function(t){e.cargandodos=!1,1==t.data.Estado?(e.Herramienta.id=t.data.Datos.id,e.Herramienta.estado=1,a.herramientas.push(e.Herramienta)):alert(t.data.Datos)},function(e){})},e.cerrar=function(){a.cerrarModal()}}]),angular.module("frontendPseApp").controller("SitiosCtrl",["$state","$scope","ApiPse","SesionUsuario","$timeout","Tabla","Estados","CasillaBotones","$uibModal",function(e,a,t,i,o,n,r,s,d){function l(){t.getResource("Sitios/ListarDisponible/"+a.Usuario.id_empresa).then(function(e){1==e.data.Estado?(a.sitios=e.data.Datos,console.log(e),a.gridOptions.data=a.sitios):(a.sitios=[],a.gridOptions.data=a.sitios,alert(e.data.Datos))},function(e){})}function c(){t.getResource("Empresas/ListarDepartamentos").then(function(e){1==e.data.Estado&&(a.departamentos=e.data.Datos)},function(e){console.log(e)})}function u(){t.getResource("Empresas/ListarCiudades").then(function(e){1==e.data.Estado&&(a.ciudades=e.data.Datos)},function(e){})}a.PanelTitulo="Registro de sitios",a.BotonTitulo="Registrar sitios",a.cargando=!1,a.Estados=r,a.panelAnimate="",a.pageAnimate="",o(function(){a.pageAnimate="pageAnimate",a.panelAnimate="panelAnimate"},100);var g="<div>";g+=s.Editar,g+=s.Borrar,g+="</div>",a.gridOptions={columnDefs:[{field:"id",minWidth:170},{field:"nombre",minWidth:170},{field:"ciudad",minWidth:170},{name:"Opciones",enableFiltering:!1,cellTemplate:g,minWidth:170}]},angular.extend(a.gridOptions,n),a.Usuario=i.ObtenerSesion(),"Super Administrador"==a.Usuario.rol&&e.go("Home"),a.Registrar=function(){a.cargando=!0,a.Register.id_empresa=a.Usuario.id_empresa,t.getResource("Sitios/Crear",a.Register).then(function(e){if(a.cargando=!1,1==e.data.Estado){for(var t=0;t<a.ciudades.length;t++)a.ciudades[t].id==parseInt(a.Register.id_ciudad)&&(a.Register.ciudad=a.ciudades[t].nombre);a.Register.id=e.data.Datos.id,a.sitios.push(a.Register),a.Register={}}},function(e){})},a.Editar=function(e){var t=a.Identifiar(e);a.Register=t,a.PanelTitulo="Editar Sitio",a.BotonTitulo="Guardar Cambios"},a.Borrar=function(e){a.cargando=!0;a.Identifiar(e)},a.Identifiar=function(e){var t={};return a.sitios.forEach(function(a,i){a.id==e&&(t.index=i,t.id=a.id,t.nombre=a.nombre,t.id_ciudad=a.id_ciudad,t.id_departamento=a.id_departamento)}),t},a.CancelarEditar=function(){a.PanelTitulo="Registro de sitios",a.BotonTitulo="Registrar sitios",a.Register={}},c(),u(),l()}]),angular.module("frontendPseApp").controller("ActividadesCtrl",["$state","$scope","ApiPse","SesionUsuario","$timeout","Tabla","Estados","CasillaBotones","$uibModal",function(e,a,t,i,o,n,r,s,d){function l(){t.getResource("Sitios/ListarDisponible/"+a.Usuario.id_empresa).then(function(e){1==e.data.Estado&&(a.sitios=e.data.Datos)},function(e){console.log(e)})}function c(){t.getResource("Actividades/ListarDisponible/"+a.Usuario.id_empresa).then(function(e){1==e.data.Estado?(a.actividades=e.data.Datos,a.gridOptions.data=a.actividades):(a.actividades=[],a.gridOptions.data=a.actividades,alert(e.data.Datos))},function(e){console.log(e)})}a.Estados=r,a.PanelTitulo="Registro de actividades",a.BotonTitulo="Registrar actividad",a.cargando=!1,a.panelAnimate="",a.pageAnimate="",o(function(){a.pageAnimate="pageAnimate",a.panelAnimate="panelAnimate"},100);var u="<div>";u+=s.Editar,u+=s.Borrar,u+="</div>",a.gridOptions={columnDefs:[{field:"id",minWidth:170},{name:"nombre",minWidth:170},{field:"sitio",minWidth:170},{name:"Opciones",enableFiltering:!1,cellTemplate:u,minWidth:170}]},angular.extend(a.gridOptions,n),a.Usuario=i.ObtenerSesion(),"Super Administrador"==a.Usuario.rol&&e.go("Home"),a.Registrar=function(){a.cargando=!0,a.Register.id_empresa=a.Usuario.id_empresa,t.getResource("Actividades/Crear",a.Register).then(function(e){if(a.cargando=!1,1==e.data.Estado){for(var t=0;t<a.sitios.length;t++)a.sitios[t].id==parseInt(a.Register.id_escenario)&&(a.Register.sitio=a.sitios[t].nombre);a.Register.id=e.data.Datos.id,a.actividades.push(a.Register),a.Register={}}else alert(e.data.Datos)},function(e){console.log(e)})},a.Editar=function(e){var t=a.Identifiar(e);a.Register=t,a.PanelTitulo="Editar Sitio",a.BotonTitulo="Guardar Cambios"},a.Borrar=function(e){a.cargando=!0;a.Identifiar(e)},a.Identifiar=function(e){var t={};return a.actividades.forEach(function(a,i){a.id==e&&(console.log(a),t.index=i,t.id=a.id,t.nombre=a.nombre,t.id_escenario=""+a.id_escenario)}),t},a.CancelarEditar=function(){a.PanelTitulo="Registro de sitios",a.BotonTitulo="Registrar sitios",a.Register={}},l(),c()}]),angular.module("frontendPseApp").controller("PrestamosCtrl",["$state",function(e){console.log(e)}]),angular.module("frontendPseApp").directive("cargando",function(){return{templateUrl:"views/directives/cargando.html",restrict:"E",link:function(e,a,t){}}}),angular.module("frontendPseApp").constant("Tabla",{enableSorting:!0,modifierKeysToMultiSelectCells:!0,enableFiltering:!0,paginationPageSizes:[10,20,30,40,50,100],paginationPageSize:10,enableColumnResizing:!0}),angular.module("frontendPseApp").directive("tablabotones",function(){return{link:function(e,a,t){var i=t.tablabotones.split(",");"Toggle"==i[1]?"1"==i[0]?($(a).text("Desactivar"),$(a).addClass("btn btn-bordered btn-xs"),$(a).addClass("btn-warning"),$(a).addClass("btn-bordered"),$(a).addClass("btn-xs")):($(a).text("Activar"),$(a).addClass("btn btn-bordered btn-xs"),$(a).addClass("btn-success"),$(a).addClass("btn-bordered"),$(a).addClass("btn-xs")):($(a).text(i[1]),$(a).addClass("btn btn-bordered btn-xs"),$(a).addClass("btn-success"),$(a).addClass("btn-bordered"),$(a).addClass("btn-xs"))}}}),angular.module("frontendPseApp").constant("Estados",{Estados:["Inactivo","Activo"],Clases:["btn btn-bordered btn-xs btn-success btn-bordered btn-xs","btn btn-bordered btn-xs btn-warning btn-bordered btn-xs","btn btn-bordered btn-xs btn-primary btn-bordered btn-xs","btn btn-bordered btn-xs btn-info btn-bordered btn-xs","btn btn-bordered btn-xs btn-danger btn-bordered btn-xs"],Contenidos:["Activar","Desactivar"]}),angular.module("frontendPseApp").constant("CasillaBotones",{Toggle:'<a ng-click="grid.appScope.Toggle(row.entity.id)" class="{{grid.appScope.Estados.Clases[row.entity.estado]}}">{{grid.appScope.Estados.Contenidos[row.entity.estado]}}</a>',Editar:'<a ng-click="grid.appScope.Editar(row.entity.id)" class="{{grid.appScope.Estados.Clases[2]}}">Editar</a>',Detalles:'<a ng-click="grid.appScope.Detalles(row.entity.id)" class="{{grid.appScope.Estados.Clases[3]}}">Detalles</a>',Borrar:'<a ng-click="grid.appScope.Borrar(row.entity.id)" class="{{grid.appScope.Estados.Clases[4]}}">Borrar</a>'});