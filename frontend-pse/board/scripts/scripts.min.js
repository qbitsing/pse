"use strict";angular.module("frontendPseApp",["ui.router","ui.bootstrap","ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngSanitize","ngTouch","LocalStorageModule","perfect_scrollbar","ui.grid","ui.grid.autoResize","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.pagination","ui.grid.cellNav","duScroll","ngImgCrop"]).config(["localStorageServiceProvider",function(e){e.setPrefix("pseApp").setStorageType("localStorage").setNotify(!0,!0)}]).config(["$stateProvider","$urlRouterProvider",function(e,a){a.when("/Dashboard","/Login"),a.otherwise("/Login"),e.state("base",{abstract:!0,url:"/Dashboard",templateUrl:"views/pages/base.html",controller:"BaseCtrl"}).state("Login",{url:"/Login",templateUrl:"views/pages/login.html",controller:"LoginCtrl"}).state("Home",{url:"/Home",parent:"base",templateUrl:"views/pages/home.html",controller:"HomeCtrl"}).state("Usuarios",{url:"/Usuarios",parent:"base",templateUrl:"views/pages/usuarios.html",controller:"UsuariosCtrl"}).state("Empresas",{url:"/Empresas",parent:"base",templateUrl:"views/pages/empresas.html",controller:"EmpresasCtrl"}).state("Items",{url:"/Gestion_Control_Equipos",parent:"base",templateUrl:"views/pages/items.html",controller:"ItemsCtrl"}).state("Sitios",{url:"/Gestion_Control_Escenarios",parent:"base",templateUrl:"views/pages/sitios.html",controller:"SitiosCtrl"}).state("Actividades",{url:"/Gestion_Control_Actividades",parent:"base",templateUrl:"views/pages/actividades.html",controller:"ActividadesCtrl"}).state("Prestamos",{url:"/Prestamos",parent:"base",templateUrl:"views/pages/prestamos.html",controller:"PrestamosCtrl"})}]),angular.module("frontendPseApp").value("duScrollDuration",700).value("duScrollOffset",60).value("duScrollActiveClass","active-login").value("duScrollBottomSpy",!0).controller("LoginCtrl",["$scope","$state","ApiPse","SesionUsuario","$uibModal","$document",function(e,a,i,t,o,r){AOS.init(),null!=t.ObtenerSesion()&&a.go("Home"),e.userLogin=function(){e.cargando=!0,i.getResource("Usuarios/Login",e.login).then(function(i){e.cargando=!1,1==i.data.Estado?(t.CrearSesion(i.data.user),a.go("Home")):(e.login.contrasenaa="",alert(i.data.Datos))},function(e){})},e.topLogin=function(){r.scrollToElementAnimated(angular.element(document.getElementById("Login")))}}]),angular.module("frontendPseApp").directive("navegacionLogin",function(){return{templateUrl:"views/directives/nav.html",restrict:"E",link:function(e,a,i){}}}),angular.module("frontendPseApp").controller("HomeCtrl",["$scope","$uibModal","ApiPse","SesionUsuario","$state","$timeout",function(e,a,i,t,o,r){function n(a){var o=t.ObtenerSesion();if(o.telefono=parseInt(o.telefono),JSON.stringify(e.Usuario)!=JSON.stringify(o)){e.cargando=!0;var r={nombres:e.Usuario.nombres,apellidos:e.Usuario.apellidos,direccion:e.Usuario.direccion,telefono:e.Usuario.telefono,correo:e.Usuario.correo};i.getResource("Usuarios/ActualizarDatos",r).then(function(i){e.cargando=!1,1==i.data.Estado?(t.ActualizarSesion(e.Usuario),1==a?alert("Las imagenes y la información se actualizaron exitosamente"):alert("La información se actualizó exitosamente")):console.log(i.data.Datos)},function(a){e.cargando=!1})}else 1==a&&alert("La imagen fue actualizada exitosamente")}e.contador=0,e.cambio=!1,e.cargando=!1,e.panelAnimate="",e.pageAnimate="",e.Usuario=t.ObtenerSesion(),e.Usuario.telefono=parseInt(e.Usuario.telefono),e.myCroppedImage="",e.MiUsuario={},r(function(){e.pageAnimate="pageAnimate",e.panelAnimate="panelAnimate"},100),i.getResource("Images/Profile/"+e.Usuario.id).then(function(a){a.data&&(e.myImage="data:image/png;base64,"+a.data,e.Imagen=e.myImage)},function(e){});var s=function(a){angular.element(document.querySelector("#inputval")).text($(this).val());var i=a.currentTarget.files[0],t=new FileReader;t.onload=function(a){e.$apply(function(e){e.contador=4,e.cambiar(),e.myImage=a.target.result})},t.readAsDataURL(i)};angular.element(document.querySelector("#fileInput")).on("change",s),e.cambiar=function(a){1==a&&e.contador<3?e.contador=1:2==a&&e.contador++,e.contador>=3&&(e.cambio=!0)},e.ImageUpdate=function(){e.cambio?(e.cargando=!0,e.MiUsuario.myImage=e.myCroppedImage,e.MiUsuario.Image=e.myImage,i.getResource("Usuarios/ActualizarImagen/"+e.Usuario.id,e.MiUsuario).then(function(a){if(e.cargando=!1,1==a.data.Estado){e.contador=3,e.cambio=!1;var i=document.getElementsByClassName("dash-profile"),t=i[0].getAttribute("src"),o="";t=="http://api.sigioth.com/Images/Avatar/"+e.Usuario.id?o="http://api.sigioth.com/Images/Recarga/"+e.Usuario.id:t=="http://api.sigioth.com/Images/Recarga/"+e.Usuario.id&&(o="http://api.sigioth.com/Images/Avatar/"+e.Usuario.id),i[0].setAttribute("src",o),n(1)}else alert(a.data.Datos)},function(a){e.cargando=!1})):n(0)}}]),angular.module("frontendPseApp").controller("BaseCtrl",["$state","$scope","SesionUsuario",function(e,a,i){a.$state=e,null==i.ObtenerSesion()&&e.go("Login")}]),angular.module("frontendPseApp").factory("ApiPse",["$http","SesionUsuario",function(e,a){return{getResource:function(i,t){var o="http://api.sigioth.com/"+i;return null!=a.ObtenerSesion()&&(void 0!=t?t.userAction=a.ObtenerSesion().id:t={userAction:a.ObtenerSesion().id}),e({method:"POST",url:o,headers:{"Content-Type":void 0},data:t})}}}]),angular.module("frontendPseApp").factory("SesionUsuario",["localStorageService",function(e){return{CrearSesion:function(a){e.set("SesionUsuario",a)},ActualizarSesion:function(a){var i=e.get("SesionUsuario");i.nombres=a.nombres,i.apellidos=a.apellidos,i.telefono=a.telefono,i.direccion=a.direccion,i.correo=a.correo,e.set("SesionUsuario",i)},ObtenerSesion:function(){return e.get("SesionUsuario")},CerrarSesion:function(){return e.remove("SesionUsuario")}}}]),angular.module("frontendPseApp").directive("sidenav",function(){return{templateUrl:"views/directives/sidenav.html",restrict:"E",link:function(e,a,i){},controller:["$scope","SesionUsuario","$state",function(e,a,i){e.Usuario=a.ObtenerSesion(),"gn-open-all"!=e.ClickMenu&&angular.element(".main-view").css("margin-left","48px"),e.CerrarSesion=function(){a.CerrarSesion(),i.go("Login")},e.menu=function(){void 0!==window.orientation&&(e.ClickMenu="",angular.element(".main-view").css("margin-left","48px"))},e.sidenav=function(){"gn-open-all"==e.ClickMenu?(e.ClickMenu="",angular.element(".main-view").css("margin-left","48px"),angular.element(".usuario").css("display","none")):(e.ClickMenu="gn-open-all",angular.element(".main-view").css("margin-left","250px"),angular.element(".usuario").css("display","block"))}}]}}),angular.module("frontendPseApp").controller("UsuariosCtrl",["$state","$scope","ApiPse","SesionUsuario","$timeout","Tabla","Estados","CasillaBotones","$uibModal",function(e,a,i,t,o,r,n,s,d){function l(){var e="";"Administrador"==a.Usuario.rol?e="Usuarios/ListarEmpresa/"+a.Usuario.id_empresa:"Super Administrador"==a.Usuario.rol&&(e="Usuarios/Listar"),i.getResource(e).then(function(e){1==e.data.Estado?(a.Usuarios=e.data.Datos,a.gridOptions.data=a.Usuarios):(a.Usuarios=[],a.gridOptions.data=a.Usuarios)},function(e){a.Usuarios=[],a.gridOptions.data=a.Usuarios,console.log(e)})}a.PanelTitulo="Registro de usuarios",a.BotonTitulo="Registrar Usuario",a.cargando=!1,a.Estados=n,a.Register={},a.Usuario=t.ObtenerSesion(),"Administrador"!=a.Usuario.rol&&"Super Administrador"!=a.Usuario.rol&&e.go("Home"),a.panelAnimate="",a.pageAnimate="";var c=null;o(function(){a.pageAnimate="pageAnimate",a.panelAnimate="panelAnimate"},100);var u="<div>";u+=s.Toggle,u+=s.Editar,u+=s.Detalles,u+=s.Borrar,u+="</div>",a.gridOptions={columnDefs:[{field:"nombres",width:"15%",minWidth:170},{field:"apellidos",width:"15%",minWidth:170},{name:"Documento",field:"id",width:"15%",minWidth:170},{field:"rol",width:"15%",minWidth:170},{field:"estado",cellTemplate:"<div>{{grid.appScope.Estados.Estados[row.entity.estado]}}</div>",width:"15%",minWidth:170}]},"Super Administrador"==a.Usuario.rol&&a.gridOptions.columnDefs.push({field:"empresa",cellTemplate:'<div>{{row.entity.empresa.nombre || "No posee"}}</div>',width:"15%",minWidth:170}),a.gridOptions.columnDefs.push({name:"Opciones",enableFiltering:!1,cellTemplate:u,width:"25%",minWidth:250}),angular.extend(a.gridOptions,r),a.Registrar=function(){"Super Administrador"==a.Register.rol&&(a.Register.id_empresa=null);var e="Usuarios/Crear";"Guardar Cambios"==a.BotonTitulo&&(e="Usuarios/Actualizar/"+a.Register.id),a.cargando=!0,"Administrador"==a.Usuario.rol&&(a.Register.id_empresa=a.Usuario.id_empresa),i.getResource(e,a.Register).then(function(i){a.cargando=!1,1==i.data.Estado&&(a.PanelTitulo="Registro de usuarios",a.BotonTitulo="Registrar Usuario","Usuarios/Crear"==e?($sope.Register.estado=1,a.Usuarios.push(a.Register),a.Register={}):"Super Administrador"!=a.Register.rol?(a.empresas.forEach(function(e,i){e.id==a.Register.id_empresa&&(a.Register.empresa=e)}),a.Usuarios[a.Register.index]=a.Register,a.Register={}):a.Usuarios.splice(a.Register.index,1)),alert(i.data.Datos)},function(e){a.Register={},a.cargando=!1})},a.Editar=function(e){var i=a.Identificar(e);a.Register=i,a.PanelTitulo="Editar usuario",a.BotonTitulo="Guardar Cambios"},a.Borrar=function(e){a.cargando=!0;var t=a.Identificar(e),o="Usuarios/Eliminar/"+t.id;i.getResource(o).then(function(e){1==e.data.Estado&&a.Usuarios.splice(t.index,1),a.cargando=!1},function(e){a.cargando=!1,console.log(e)})},a.Toggle=function(e){a.cargando=!0;var t=a.Identificar(e);1==t.estado?t.estado=0:t.estado=1;var o="Usuarios/Actualizar/"+t.id;i.getResource(o,t).then(function(e){1==e.data.Estado&&(a.Usuarios[t.index]=t),a.cargando=!1},function(e){a.cargando=!1,console.log(e)})},a.Detalles=function(e){switch(a.obj=a.Identificar(e),a.obj.tipo_doc){case"0":a.obj.tipo_documento="Nit";break;case"1":a.obj.tipo_documento="Cedula de Ciudadania";break;case"2":a.obj.tipo_documento="Cedula de Extranjeria";break;case"3":a.obj.tipo_documento="Pasaporte"}c=d.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"myModalContent.html",controller:"DetalleUsuarioModalCtrl",resolve:{Scope:function(){return a}}})},a.cerrarModal=function(){c.close()},a.CancelarEditar=function(){a.PanelTitulo="Registro de usuarios",a.BotonTitulo="Registrar Usuario",a.Register={}},a.Identificar=function(e){var i={};return a.Usuarios.forEach(function(a,t){a.id==e&&(i.index=t,i.id=a.id,i.rol=a.rol,i.nombres=a.nombres,i.apellidos=a.apellidos,i.telefono=a.telefono,i.direccion=a.direccion,i.correo=a.correo,i.estado=a.estado,i.id_empresa=a.id_empresa,i.empresa=a.empresa,i.tipo_doc=a.tipo_doc.toString())}),i},function(){i.getResource("Empresas/ListarDisponible").then(function(e){l(),1==e.data.Estado?a.empresas=e.data.Datos:a.empresas=[{id:"0",nombre:"No hay ninguna empresa registrada"}]},function(e){})}()}]).controller("DetalleUsuarioModalCtrl",["$scope","Scope",function(e,a){e.Detalle=a.obj,e.Cerrar=function(){a.cerrarModal()}}]),angular.module("frontendPseApp").directive("tbas",function(){return{template:"<div></div>",restrict:"E",link:function(e,a,i){a.text("this is the tbas directive")}}}),angular.module("frontendPseApp").controller("EmpresasCtrl",["$scope","SesionUsuario","ApiPse","$state","$timeout","Tabla","Estados","CasillaBotones","$uibModal",function(e,a,i,t,o,r,n,s,d){function l(){i.getResource("Empresas/ListarCiudades").then(function(a){1==a.data.Estado?e.ciudades=a.data.Datos:e.ciudades=[],c()},function(e){})}function c(){i.getResource("Empresas/ListarDisponible").then(function(a){1==a.data.Estado?(e.empresas=a.data.Datos,e.gridOptions.data=e.empresas):(e.empresas=[],e.gridOptions.data=e.empresas)},function(a){e.empresas=[],e.gridOptions.data=e.empresas,console.log(a)})}e.Usuario=a.ObtenerSesion(),"Super Administrador"!=e.Usuario.rol&&t.go("Home"),e.PanelTitulo="Registro de empresas",e.BotonTitulo="Registrar empresa",e.cargando=!1,e.Estados=n,e.panelAnimate="",e.pageAnimate="";var u=null;o(function(){e.pageAnimate="pageAnimate",e.panelAnimate="panelAnimate"},100);var m="<div>";m+=s.Toggle,m+=s.Editar,m+=s.Detalles,m+=s.Borrar,m+="</div>",e.gridOptions={columnDefs:[{name:"NIT",field:"id",width:"15%",minWidth:170},{field:"nombre",width:"15%",minWidth:170},{field:"direccion",width:"15%",minWidth:170},{field:"telefono",width:"15%",minWidth:170},{field:"estado",cellTemplate:"<div>{{grid.appScope.Estados.Estados[row.entity.estado]}}</div>",width:"15%",minWidth:170},{name:"Opciones",enableFiltering:!1,cellTemplate:m,width:"25%",minWidth:170}]},angular.extend(e.gridOptions,r),e.Registrar=function(){e.cargando=!0,i.getResource("Empresas/Crear",e.Register).then(function(a){e.empresas.push(e.Register),e.Register={},e.cargando=!1},function(a){e.cargando=!1})},e.Editar=function(a){var i=e.Identificar(a);e.Register=i,e.PanelTitulo="Editar empresa",e.BotonTitulo="Guardar Cambios"},e.Borrar=function(a){e.cargando=!0;var t=e.Identificar(a),o="Empresas/Eliminar/"+t.id;i.getResource(o).then(function(a){1==a.data.Estado&&e.empresas.splice(t.index,1),e.cargando=!1},function(a){e.cargando=!1,console.log(a)})},e.Toggle=function(a){e.cargando=!0;var t=e.Identificar(a);1==t.estado?t.estado=0:t.estado=1;var o="Empresas/Actualizar/"+t.id;i.getResource(o,t).then(function(a){1==a.data.Estado&&(e.empresas[t.index]=t),e.cargando=!1},function(a){e.cargando=!1,console.log(a)})},e.Detalles=function(a){e.obj=e.Identificar(a),e.departamentos.forEach(function(a,i){a.id==e.obj.id_departamento&&(e.obj.nombre_departamento=a.nombre)}),e.ciudades.forEach(function(a,i){a.id==e.obj.ciudad&&(e.obj.nombre_ciudad=a.nombre)}),u=d.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"myModalContent.html",controller:"DetalleEmpresaModalCtrl",resolve:{Scope:function(){return e}}})},e.cerrarModal=function(){u.close()},e.CancelarEditar=function(){e.PanelTitulo="Registro de empresas",e.BotonTitulo="Registrar empresa",e.Register={}},e.Identificar=function(a){var i={};return e.empresas.forEach(function(e,t){e.id==a&&(i.index=t,i.id=e.id,i.nombre=e.nombre,i.telefono=e.telefono,i.direccion=e.direccion,i.id_departamento=e.id_departamento,i.ciudad=e.ciudad,i.estado=e.estado)}),i},function(){i.getResource("Empresas/ListarDepartamentos").then(function(a){1==a.data.Estado?e.departamentos=a.data.Datos:e.ciudades=[],l()},function(e){console.log(e)})}()}]).controller("DetalleEmpresaModalCtrl",["$scope","Scope",function(e,a){e.Detalle=a.obj,e.Cerrar=function(){a.cerrarModal()}}]),angular.module("frontendPseApp").controller("ItemsCtrl",["$scope","$uibModal","ApiPse","SesionUsuario","$state","$timeout","Tabla","Estados","CasillaBotones",function(e,a,i,t,o,r,n,s,d){function l(){i.getResource("Items/ListarDisponible/"+e.Usuario.id_empresa).then(function(a){1==a.data.Estado?(e.items=a.data.Datos,e.gridOptions.data=e.items):(e.items=[],e.gridOptions.data=e.items,alert(a.data.Datos))},function(e){})}e.Estados=s,e.PanelTitulo="Registro de Equipos",e.BotonTitulo="Registrar Equipo",e.cargando=!1,e.cargandodos=!1;var c=null;e.Usuario=t.ObtenerSesion(),e.panelAnimate="",e.pageAnimate="",r(function(){e.pageAnimate="pageAnimate",e.panelAnimate="panelAnimate"},100);var u="<div>";u+=d.Toggle,u+=d.Editar,u+=d.Borrar,u+="</div>";var m="<div>";m+=d.Editar,m+=d.Borrar,m+="</div>",e.gridOptions={columnDefs:[{field:"herramienta",width:"20%",minWidth:170},{field:"modelo",width:"20%",minWidth:170},{field:"codigo_unico",width:"20%",minWidth:170},{field:"estado",cellTemplate:"<div>{{grid.appScope.Estados.Estados[row.entity.estado]}}</div>",width:"20%",minWidth:170},{name:"Opciones",enableFiltering:!1,cellTemplate:u,width:"20%",minWidth:170}]},e.gridDates={columnDefs:[{field:"id",width:"33.99%",minWidth:170},{field:"nombre",width:"33.99%",minWidth:170},{name:"Opciones",enableFiltering:!1,cellTemplate:m,width:"33.99%",minWidth:170}]},angular.extend(e.gridOptions,n),angular.extend(e.gridDates,n),"Super Administrador"==t.ObtenerSesion().rol&&o.go("Home"),e.Registrar=function(){e.cargando=!0,e.Register.id_empresa=e.Usuario.id_empresa,i.getResource("Items/Crear",e.Register).then(function(a){if(e.cargando=!1,1==a.data.Estado){for(var i=0;i<e.herramientas.length;i++)e.herramientas[i].id==parseInt(e.Register.id_herramienta)&&(e.Register.herramienta=e.herramientas[i].nombre);for(var i=0;i<e.Register.cantidad;i++){var t={id:a.data.Datos[i].id,herramienta:e.Register.herramienta,modelo:e.Register.modelo,codigo_unico:a.data.Datos[i].codigo};e.items.push(t)}e.Register.id=a.data.Datos.id,e.Register={}}else alert(a.data.Datos)},function(e){})},e.Editar=function(a){var i=e.Identifiar(a);e.Register=i,e.PanelTitulo="Editar Equipo",e.BotonTitulo="Guardar Cambios"},e.Borrar=function(a){e.cargando=!0;e.Identifiar(a)},e.Toggle=function(){e.Identifiar(id)},e.CancelarEditar=function(){e.PanelTitulo="Registro de Equipos",e.BotonTitulo="Registrar Equipo",e.Herramienta={}},e.Identifiar=function(a){var i={};return e.items.forEach(function(e,t){e.id==a&&(i.index=t,i.id=e.id,i.modelo=e.modelo,i.estado=e.estado,i.codigo_unico=e.codigo_unico,i.id_herramienta=""+e.id_herramienta)}),i},e.AbrirModal=function(){c=a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"myModalContent.html",controller:"CrearHerramientaCtrl",resolve:{Scope:function(){return e}}})},e.cerrarModal=function(){e.Herramienta={},c.close()},function(){i.getResource("Herramientas/ListarDisponible/"+e.Usuario.id_empresa).then(function(a){1==a.data.Estado?(e.herramientas=a.data.Datos,e.herras=a.data.Datos,e.gridDates.data=e.herras):(e.herramientas=[],e.herras=[],e.gridDates.data=e.herras,alert(a.data.Datos)),l()},function(e){})}()}]).controller("CrearHerramientaCtrl",["$scope","Scope","$uibModal","ApiPse","Estados",function(e,a,i,t,o){e.Estados=o,e.PanelTitulo="Registro de Herramientas",e.BotonTitulo="Registrar Herramienta",e.cargandodos=!1,e.gridDates=a.gridDates,e.Herramientas=e.gridDates.data,e.RegisterHerramienta=function(){e.cargandodos=!0;var i="Herramientas/Crear";"Guardar Cambios"==e.BotonTitulo&&(i="Herramientas/Actualizar/"+e.Herramienta.id),e.Herramienta.id_empresa=a.Usuario.id_empresa,t.getResource(i,e.Herramienta).then(function(t){1==t.data.Estado&&("Herramientas/Crear"==i?(e.Herramienta.id=t.data.Datos.id,e.Herramienta.estado=1,a.herramientas.push(e.Herramienta)):(a.herramientas[e.Herramienta.index]=e.Herramienta,e.PanelTitulo="Registro de Herramientas",e.BotonTitulo="Registrar Herramienta"),e.Herramienta={}),e.cargandodos=!1},function(a){console.log(a),e.cargando=!1})},e.Editar=function(a){var i=e.Identifiar(a);e.Herramienta=i,e.PanelTitulo="Editar Herramienta",e.BotonTitulo="Guardar Cambios"},e.Borrar=function(a){e.cargando=!0;var i=e.Identifiar(a),o="Herramientas/Eliminar/"+i.id;t.getResource(o).then(function(a){1==a.data.Estado&&e.Herramientas.splice(i.index,1),e.cargando=!1},function(a){e.cargando=!1,console.log(a)})},e.CancelarEditar=function(){e.PanelTitulo="Registro de Herramientas",e.BotonTitulo="Registrar Herramienta",e.Herramienta={}},e.Identifiar=function(a){var i={};return e.Herramientas.forEach(function(e,t){e.id==a&&(i.index=t,i.id=e.id,i.nombre=e.nombre)}),i},e.cerrar=function(){a.cerrarModal()}}]),angular.module("frontendPseApp").controller("SitiosCtrl",["$state","$scope","ApiPse","SesionUsuario","$timeout","Tabla","Estados","CasillaBotones","$uibModal",function(e,a,i,t,o,r,n,s,d){function l(){i.getResource("Sitios/ListarDisponible/"+a.Usuario.id_empresa).then(function(e){1==e.data.Estado?(a.sitios=e.data.Datos,a.gridOptions.data=a.sitios):(a.sitios=[],a.gridOptions.data=a.sitios,alert(e.data.Datos))},function(e){})}function c(){i.getResource("Empresas/ListarCiudades").then(function(e){l(),1==e.data.Estado&&(a.ciudades=e.data.Datos)},function(e){})}a.PanelTitulo="Registro de sitios",a.BotonTitulo="Registrar sitios",a.cargando=!1,a.Estados=n,a.panelAnimate="",a.pageAnimate="",o(function(){a.pageAnimate="pageAnimate",a.panelAnimate="panelAnimate"},100);var u="<div>";u+=s.Editar,u+=s.Borrar,u+="</div>",a.gridOptions={columnDefs:[{field:"id",width:"25%",minWidth:170},{field:"nombre",width:"25%",minWidth:170},{field:"ciudad",width:"25%",minWidth:170},{name:"Opciones",enableFiltering:!1,cellTemplate:u,width:"25%",minWidth:170}]},angular.extend(a.gridOptions,r),a.Usuario=t.ObtenerSesion(),"Super Administrador"==a.Usuario.rol&&e.go("Home"),a.Registrar=function(){a.cargando=!0;var e="Sitios/Crear";"Guardar Cambios"==a.BotonTitulo&&(e="Sitios/Actualizar/"+a.Register.id),a.Register.id_empresa=a.Usuario.id_empresa,i.getResource(e,a.Register).then(function(i){if(a.cargando=!1,1==i.data.Estado){for(var t=0;t<a.ciudades.length;t++)a.ciudades[t].id==parseInt(a.Register.id_ciudad)&&(a.Register.ciudad=a.ciudades[t].nombre);a.Register.id=i.data.Datos.id,a.PanelTitulo="Registro de usuarios",a.BotonTitulo="Registrar Sitio","Sitios/Crear"==e?(a.sitios.push(a.Register),a.Register={}):(a.sitios[a.Register.index]=a.Register,a.Register={})}},function(e){console.log(e),a.cargando=!1})},a.Editar=function(e){var i=a.Identifiar(e);a.Register=i,a.PanelTitulo="Editar Sitio",a.BotonTitulo="Guardar Cambios"},a.Borrar=function(e){a.cargando=!0;var t=a.Identifiar(e);i.getResource("Sitios/Eliminar/"+t.id).then(function(e){1==e.data.Estado?a.sitios.splice(t.index,1):alert("El sitio no se ha podido eliminar"),a.cargando=!1},function(e){a.cargando=!1,console.log(e)})},a.Identifiar=function(e){var i={};return a.sitios.forEach(function(a,t){a.id==e&&(i.index=t,i.id=a.id,i.nombre=a.nombre,i.id_ciudad=a.id_ciudad,i.id_departamento=a.id_departamento)}),i},a.CancelarEditar=function(){a.PanelTitulo="Registro de sitios",a.BotonTitulo="Registrar sitios",a.Register={}},function(){i.getResource("Empresas/ListarDepartamentos").then(function(e){c(),1==e.data.Estado&&(a.departamentos=e.data.Datos)},function(e){console.log(e)})}()}]),angular.module("frontendPseApp").controller("ActividadesCtrl",["$state","$scope","ApiPse","SesionUsuario","$timeout","Tabla","Estados","CasillaBotones","$uibModal",function(e,a,i,t,o,r,n,s,d){function l(){i.getResource("Actividades/ListarDisponible/"+a.Usuario.id_empresa).then(function(e){1==e.data.Estado?(a.actividades=e.data.Datos,a.gridOptions.data=a.actividades):(a.actividades=[],a.gridOptions.data=a.actividades)},function(e){console.log(e)})}a.Estados=n,a.PanelTitulo="Registro de actividades",a.BotonTitulo="Registrar actividad",a.cargando=!1,a.panelAnimate="",a.pageAnimate="",o(function(){a.pageAnimate="pageAnimate",a.panelAnimate="panelAnimate"},100);var c="<div>";c+=s.Editar,c+=s.Borrar,c+="</div>",a.gridOptions={columnDefs:[{field:"id",width:"25%",minWidth:170},{name:"nombre",width:"25%",minWidth:170},{field:"sitio",width:"25%",minWidth:170},{name:"Opciones",enableFiltering:!1,cellTemplate:c,width:"25%",minWidth:170}]},angular.extend(a.gridOptions,r),a.Usuario=t.ObtenerSesion(),"Super Administrador"==a.Usuario.rol&&e.go("Home"),a.Registrar=function(){a.cargando=!0;var e="Actividades/Crear";a.Register.id_empresa=a.Usuario.id_empresa,"Guardar Cambios"==a.BotonTitulo&&(e="Actividades/Actualizar/"+a.Register.id),console.log(a.Register),i.getResource(e,a.Register).then(function(i){if(a.cargando=!1,1==i.data.Estado){for(var t=0;t<a.sitios.length;t++)a.sitios[t].id==parseInt(a.Register.id_escenario)&&(a.Register.sitio=a.sitios[t].nombre);"Actividades/Crear"==e?(a.Register.id=i.data.Datos.id,a.actividades.push(a.Register)):a.actividades[a.Register.index]=a.Register,a.PanelTitulo="Registro de sitios",a.BotonTitulo="Registrar sitios",a.Register={}}else alert(i.data.Datos)},function(e){console.log(e)})},a.Editar=function(e){var i=a.Identificar(e);a.Register=i,a.PanelTitulo="Editar Sitio",a.BotonTitulo="Guardar Cambios"},a.Borrar=function(e){a.cargando=!0;var t=a.Identificar(e),o="Actividades/Eliminar/"+t.id;i.getResource(o).then(function(e){1==e.data.Estado?a.actividades.splice(t.index,1):alert(e.data.Datos),a.cargando=!1},function(e){a.cargando=!1,console.log(e)})},a.Identificar=function(e){var i={};return a.actividades.forEach(function(a,t){a.id==e&&(i.index=t,i.id=a.id,i.nombre=a.nombre,i.id_escenario=""+a.id_escenario)}),i},a.CancelarEditar=function(){a.PanelTitulo="Registro de sitios",a.BotonTitulo="Registrar sitios",a.Register={}},function(){i.getResource("Sitios/ListarDisponible/"+a.Usuario.id_empresa).then(function(e){l(),1==e.data.Estado?a.sitios=e.data.Datos:a.sitios=[{id:"0",nombre:"No hay ningun sitio registrado"}]},function(e){console.log(e)})}()}]),angular.module("frontendPseApp").controller("PrestamosCtrl",["$state",function(e){console.log(e)}]),angular.module("frontendPseApp").directive("cargando",function(){return{templateUrl:"views/directives/cargando.html",restrict:"E",link:function(e,a,i){}}}),angular.module("frontendPseApp").constant("Tabla",{enableSorting:!0,modifierKeysToMultiSelectCells:!0,enableFiltering:!0,paginationPageSizes:[10,20,30,40,50,100],paginationPageSize:10,enableColumnResizing:!0}),angular.module("frontendPseApp").directive("tablabotones",function(){return{link:function(e,a,i){var t=i.tablabotones.split(",");"Toggle"==t[1]?"1"==t[0]?($(a).text("Desactivar"),$(a).addClass("btn btn-bordered btn-xs"),$(a).addClass("btn-warning"),$(a).addClass("btn-bordered"),$(a).addClass("btn-xs")):($(a).text("Activar"),$(a).addClass("btn btn-bordered btn-xs"),$(a).addClass("btn-success"),$(a).addClass("btn-bordered"),$(a).addClass("btn-xs")):($(a).text(t[1]),$(a).addClass("btn btn-bordered btn-xs"),$(a).addClass("btn-success"),$(a).addClass("btn-bordered"),$(a).addClass("btn-xs"))}}}),angular.module("frontendPseApp").constant("Estados",{Estados:["No Disponible","Disponible","Prestado","En Mantenimiento","Eliminado"],Clases:["btn btn-bordered btn-xs btn-success btn-bordered btn-xs","btn btn-bordered btn-xs btn-warning btn-bordered btn-xs","btn btn-bordered btn-xs btn-primary btn-bordered btn-xs","btn btn-bordered btn-xs btn-info btn-bordered btn-xs","btn btn-bordered btn-xs btn-danger btn-bordered btn-xs"],Contenidos:["Activar","Desactivar","Activar","Activar","Activar"]}),angular.module("frontendPseApp").constant("CasillaBotones",{Toggle:'<a ng-click="grid.appScope.Toggle(row.entity.id)" class="{{grid.appScope.Estados.Clases[row.entity.estado]}}">{{grid.appScope.Estados.Contenidos[row.entity.estado]}}</a>',Editar:'<a ng-click="grid.appScope.Editar(row.entity.id)" class="{{grid.appScope.Estados.Clases[2]}}">Editar</a>',Detalles:'<a ng-click="grid.appScope.Detalles(row.entity.id)" class="{{grid.appScope.Estados.Clases[3]}}">Detalles</a>',Borrar:'<a ng-click="grid.appScope.Borrar(row.entity.id)" class="{{grid.appScope.Estados.Clases[4]}}">Borrar</a>'});